# Logging & Observability System

The `logs/` directory serves as the central repository for all system logs, observability data, and operational metrics generated by the AdvancedRules AI orchestration framework. This comprehensive logging system provides visibility into framework operations, decision-making processes, and system health.

## üìÅ Directory Structure

```
logs/
‚îú‚îÄ‚îÄ README.md                    # This logging system overview
‚îú‚îÄ‚îÄ decision_metrics.json        # Decision scoring metrics and analytics
‚îú‚îÄ‚îÄ decisions/                   # Decision scoring log history
‚îÇ   ‚îú‚îÄ‚îÄ 20250828_103713.json     # Individual decision log entries
‚îÇ   ‚îú‚îÄ‚îÄ 20250828_112239.json     # Timestamped decision records
‚îÇ   ‚îú‚îÄ‚îÄ 20250828_142251.json     # Historical decision analysis
‚îÇ   ‚îú‚îÄ‚îÄ 20250828_142313.json     # Framework decision outcomes
‚îÇ   ‚îî‚îÄ‚îÄ 20250828_142955.json     # Latest decision log entry
‚îú‚îÄ‚îÄ events.jsonl                 # Structured event stream (JSON Lines)
‚îî‚îÄ‚îÄ observability/               # System observability and monitoring
    ‚îú‚îÄ‚îÄ summary.json            # Comprehensive observability metrics
    ‚îî‚îÄ‚îÄ summary.md              # Human-readable observability report
```

## üéØ Purpose & Functionality

### Comprehensive Monitoring
- **System Visibility**: Complete view of framework operations and performance
- **Decision Tracking**: Detailed records of all decision-making processes
- **Event Streaming**: Real-time event capture and analysis
- **Performance Metrics**: System performance and efficiency tracking

### Operational Intelligence
- **Troubleshooting**: Detailed logs for issue diagnosis and resolution
- **Analytics**: Data-driven insights into framework behavior
- **Compliance**: Audit trails for regulatory and quality requirements
- **Optimization**: Performance data for system optimization

## üìã Log Categories

### Decision Logs (`decisions/`)
**Purpose**: Captures all decision scoring activities and outcomes

**File Format**: JSON with timestamp-based naming convention
**Naming Convention**: `YYYYMMDD_HHMMSS.json`

**Content Structure**:
```json
{
  "context_summary": "Brief description of decision context",
  "candidates": [
    {
      "id": "unique_candidate_id",
      "action_type": "COMMAND_TRIGGER|NATURAL_STEP",
      "scores": {
        "intent": 0.95,
        "state": 0.90,
        "evidence": 0.85,
        "recency": 0.88,
        "pref": 0.92,
        "final": 0.90
      },
      "explanation": "Why this candidate was selected",
      "preconds": ["condition1", "condition2"]
    }
  ],
  "decision": {
    "type": "NEXT_STEP",
    "top": "selected_candidate_id"
  },
  "timestamp": "2025-08-28T14:29:55"
}
```

**Key Features**:
- Multi-criteria scoring system
- Candidate evaluation and ranking
- Decision outcome tracking
- Temporal analysis capabilities

### Event Stream (`events.jsonl`)
**Purpose**: Real-time event capture for system monitoring

**File Format**: JSON Lines (one JSON object per line)
**Content Structure**:
```json
{"timestamp": "2025-08-28T14:29:55", "event_type": "decision_scored", "candidate_id": "validate_system_readiness", "scores": {"final": 0.873}}
{"timestamp": "2025-08-28T14:30:12", "event_type": "artifact_created", "artifact_path": "memory-bank/plan/client_brief.md", "size_bytes": 2048}
{"timestamp": "2025-08-28T14:30:25", "event_type": "role_execution", "persona": "product_owner_ai", "action": "create_user_stories"}
```

**Event Types**:
- `decision_scored`: Decision scoring activities
- `artifact_created`: New artifact generation
- `role_execution`: AI persona activities
- `validation_passed`: Quality gate success
- `validation_failed`: Quality gate failure
- `system_health`: System status updates

### Decision Metrics (`decision_metrics.json`)
**Purpose**: Aggregated analytics and performance metrics

**Content Structure**:
```json
{
  "summary": {
    "total_decisions": 150,
    "average_confidence": 0.82,
    "top_candidates": ["validate_system_readiness", "run_decision_scorer"],
    "time_range": "2025-08-28 to 2025-08-29"
  },
  "metrics": {
    "intent": {"mean": 0.85, "std": 0.12, "min": 0.45, "max": 0.98},
    "state": {"mean": 0.78, "std": 0.15, "min": 0.32, "max": 0.95},
    "evidence": {"mean": 0.82, "std": 0.11, "min": 0.51, "max": 0.97},
    "recency": {"mean": 0.88, "std": 0.08, "min": 0.62, "max": 0.99},
    "pref": {"mean": 0.80, "std": 0.14, "min": 0.38, "max": 0.96}
  },
  "trends": {
    "confidence_trend": "increasing",
    "decision_speed": "stable",
    "candidate_diversity": "high"
  }
}
```

### Observability Reports (`observability/`)
**Purpose**: System health monitoring and performance analysis

#### `summary.json`
Comprehensive system metrics in machine-readable format

#### `summary.md`
Human-readable observability report with:
- System health status
- Performance metrics
- Resource utilization
- Error rates and trends
- Recommendations for optimization

## üîß Log Management

### Log Rotation & Retention
```bash
# Archive old decision logs
find logs/decisions/ -name "*.json" -mtime +30 -exec mv {} logs/archive/ \;

# Compress archived logs
gzip logs/archive/*.json

# Clean old event logs (keep last 7 days)
find logs/ -name "events.jsonl" -exec sh -c 'tail -n 10000 "$1" > "$1.tmp" && mv "$1.tmp" "$1"' _ {} \;
```

### Log Analysis Tools
```bash
# Analyze decision patterns
python3 ../tools/observability/aggregate.py --analyze-decisions

# Generate performance reports
python3 ../tools/observability/aggregate.py --performance-report

# Extract specific events
grep "decision_scored" logs/events.jsonl | jq '.candidate_id'

# Monitor system health
python3 ../tools/observability/aggregate.py --health-check
```

### Automated Processing
```bash
# Generate daily observability summary
python3 ../tools/observability/aggregate.py

# Update decision metrics
python3 ../tools/decision_scoring/compute_metrics.py

# Archive and compress logs
./scripts/log_maintenance.sh
```

## üìä Analytics & Insights

### Decision Analysis
- **Scoring Distribution**: Analyze confidence levels across decisions
- **Candidate Performance**: Track which candidates are frequently selected
- **Temporal Patterns**: Identify decision-making patterns over time
- **Success Rates**: Measure decision outcome effectiveness

### System Performance
- **Execution Times**: Monitor operation completion times
- **Resource Usage**: Track memory, CPU, and I/O utilization
- **Error Patterns**: Identify recurring issues and failure modes
- **Throughput Metrics**: Measure system processing capacity

### Quality Metrics
- **Validation Success**: Percentage of artifacts passing validation
- **Artifact Quality**: Measure of generated artifact completeness
- **Process Efficiency**: Time from initiation to completion
- **Error Recovery**: System resilience and recovery capabilities

## üîç Log Investigation

### Troubleshooting Workflows
1. **Identify Issue**: Review recent events and decision logs
2. **Gather Context**: Collect relevant system state information
3. **Analyze Patterns**: Look for recurring issues or anomalies
4. **Root Cause Analysis**: Trace issues through the event stream
5. **Resolution Tracking**: Monitor fix effectiveness

### Debug Mode Logging
```bash
# Enable verbose logging
DEBUG=1 python3 ../tools/run_role.py product_owner_ai

# Log specific component
LOG_LEVEL=DEBUG python3 ../tools/decision_scoring/advanced_score.py

# Trace decision process
TRACE_DECISIONS=1 python3 ../tools/orchestrator/trigger_next.py
```

## üö® Alerting & Monitoring

### Automated Alerts
- **Decision Quality**: Alert when confidence scores fall below threshold
- **System Performance**: Monitor for performance degradation
- **Error Rates**: Track and alert on increasing error rates
- **Resource Usage**: Alert on resource utilization thresholds

### Health Checks
```bash
# Comprehensive system health check
python3 ../tools/observability/aggregate.py --health-check

# Decision system validation
python3 ../tools/decision_scoring/validate_system.py

# Log integrity verification
python3 ../tools/artifacts/hash_index.py --verify-logs
```

## üìà Reporting & Visualization

### Standard Reports
- **Daily Summary**: System activity and performance overview
- **Decision Analytics**: Decision-making effectiveness analysis
- **Performance Dashboard**: Real-time system metrics
- **Trend Analysis**: Long-term system behavior patterns

### Custom Analytics
```bash
# Generate custom decision reports
python3 ../tools/observability/aggregate.py --custom-report decisions

# Performance trend analysis
python3 ../tools/observability/aggregate.py --trend-analysis

# Comparative analysis
python3 ../tools/observability/aggregate.py --compare-periods "2025-08-01:2025-08-15"
```

## üîí Security & Compliance

### Log Security
- **Access Control**: Restricted access to sensitive log data
- **Encryption**: Encrypted storage for sensitive information
- **Integrity**: SHA-256 hashing for log integrity verification
- **Retention Policies**: Compliant data retention and deletion policies

### Audit Trails
- **Complete Traceability**: Every action is logged with full context
- **Non-repudiation**: Cryptographically signed log entries
- **Compliance Reporting**: Automated compliance report generation
- **Chain of Custody**: Maintained custody chain for legal requirements

## üìã Maintenance Procedures

### Regular Maintenance
```bash
# Daily log rotation
./scripts/rotate_logs.sh

# Weekly archive compression
./scripts/archive_logs.sh

# Monthly cleanup
./scripts/cleanup_logs.sh
```

### Backup & Recovery
```bash
# Backup critical logs
./scripts/backup_logs.sh --critical-only

# Restore from backup
./scripts/restore_logs.sh --date 2025-08-28

# Verify backup integrity
./scripts/verify_backup.sh
```

## üéØ Best Practices

### Logging Standards
- **Consistent Format**: Standardized log entry formats across components
- **Structured Data**: JSON-structured logs for easy parsing and analysis
- **Timestamps**: Consistent UTC timestamps with millisecond precision
- **Context Information**: Rich context in every log entry

### Performance Considerations
- **Efficient Storage**: Optimized storage formats and compression
- **Query Performance**: Indexed logs for fast retrieval
- **Resource Management**: Controlled resource usage for logging operations
- **Scalability**: Logging system scales with framework growth

### Privacy & Data Protection
- **Data Minimization**: Only log necessary information
- **PII Handling**: Proper handling of personally identifiable information
- **Data Classification**: Classified log data with appropriate protection
- **Retention Limits**: Automatic cleanup of expired log data

---

**Logging & Observability System** - Complete visibility into AdvancedRules AI orchestration operations! üìäüìà

*For framework usage, see the main [README](../README.md). For log analysis, run `python3 ../tools/observability/aggregate.py`.*
